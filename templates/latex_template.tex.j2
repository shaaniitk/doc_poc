{# templates/latex_template.tex.j2 #}

((* if preserved and preserved.latex_preamble *))
    ((( preserved.latex_preamble | safe )))
((* else *))
    {# Fallback to a default preamble if none was preserved #}
    \documentclass{article}
    \usepackage[utf8]{inputenc}
    \usepackage{graphicx}
    \usepackage{amsmath}
    \title{Refactored Document}
    \author{Gemini Refactor Engine}
    \date{\today}
    \begin{document}
    \maketitle
((* endif *))

{# --- The rest of the template remains the same --- #}

((* macro render_nodes(node_level, level) *))
    ...
((* endmacro *))

((( render_nodes(processed_tree, 1) )))

...

\end{document}